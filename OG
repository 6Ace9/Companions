import streamlit as st
from streamlit.components.v1 import html

st.set_page_config(page_title="Companions", layout="wide")

background_url = "https://raw.githubusercontent.com/6Ace9/Companions/main/Companions.jpg"

full_html = f"""
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Companions</title>
    <style>
        body, html {{
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background: url('{background_url}') no-repeat center center fixed;
            background-size: 100% 100%;
            background-color: black;
        }}
        .ring-button {{
            width: 260px;
            height: 260px;
            border-radius: 50%;
            background: transparent;
            border: 10px solid;
            cursor: move;
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 25px white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            transition: transform 0.4s ease;
            box-sizing: border-box;
            user-select: none;
            touch-action: none;
            z-index: 10;
        }}
        .ring-button:hover {{
            transform: scale(1.2);
        }}
        #owl-ring {{
            border-color: #c084fc;
            box-shadow: 0 0 50px 15px #a855f7, 0 0 100px 35px #7e22ce, inset 0 0 80px 10px rgba(139,92,246,0.5);
            animation: owlPulse 4s ease-in-out infinite;
        }}
        @keyframes owlPulse {{
            0%, 100% {{ box-shadow: 0 0 50px 15px #a855f7, 0 0 100px 35px #7e22ce, inset 0 0 80px 10px rgba(139,92,246,0.5); }}
            50% {{ box-shadow: 0 0 80px 30px #c084fc, 0 0 150px 60px #a855f7, inset 0 0 120px 20px rgba(168,85,247,0.7); }}
        }}
        #koi-ring {{
            border-color: #7dd3fc;
            box-shadow: 0 0 50px 12px #38bdf8, 0 0 100px 30px #0ea5e9, inset 0 0 80px 8px rgba(56,189,248,0.4);
            animation: koiPulse 5s ease-in-out infinite;
        }}
        @keyframes koiPulse {{
            0%, 100% {{ box-shadow: 0 0 50px 12px #38bdf8, 0 0 100px 30px #0ea5e9, inset 0 0 80px 8px rgba(56,189,248,0.4); }}
            50% {{ box-shadow: 0 0 80px 25px #7dd3fc, 0 0 150px 55px #38bdf8, inset 0 0 120px 15px rgba(125,211,252,0.6); }}
        }}
        #fox-ring {{
            border-color: #fb923c;
            box-shadow: 0 0 50px 15px #f97316, 0 0 100px 35px #ea580c, inset 0 0 80px 10px rgba(251,146,60,0.5);
            animation: foxPulse 3s ease-in-out infinite;
        }}
        @keyframes foxPulse {{
            0%, 100% {{ box-shadow: 0 0 50px 15px #f97316, 0 0 100px 35px #ea580c, inset 0 0 80px 10px rgba(251,146,60,0.5); }}
            50% {{ box-shadow: 0 0 85px 30px #fb923c, 0 0 160px 65px #f97316, inset 0 0 130px 20px rgba(251,146,60,0.8); }}
        }}
        #lock-btn {{
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 30px;
            background: red;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255,0,0,0.9);
        }}
        #lock-btn.locked {{
            background: green;
            box-shadow: 0 0 20px rgba(0,255,0,0.9);
        }}
    </style>
</head>
<body>
    <button id="owl-ring" class="ring-button">Owl</button>
    <button id="koi-ring" class="ring-button">Koi</button>
    <button id="fox-ring" class="ring-button">Fox</button>
    <button id="lock-btn">Unlock Dragging</button>

    <script>
        const positions = {{
            'owl-ring': {{x: 20, y: 40}},
            'koi-ring': {{x: 50, y: 60}},
            'fox-ring': {{x: 80, y: 45}}
        }};

        // Load saved positions from localStorage
        Object.keys(positions).forEach(id => {{
            const saved = localStorage.getItem(id);
            if (saved) positions[id] = JSON.parse(saved);
        }});

        // Apply initial positions
        Object.keys(positions).forEach(id => {{
            const el = document.getElementById(id);
            el.style.left = `${{positions[id].x}}vw`;
            el.style.top = `${{positions[id].y}}vh`;
        }});

        let dragging = null;
        let offset = {{x: 0, y: 0}};
        let locked = false;

        const lockBtn = document.getElementById('lock-btn');
        lockBtn.addEventListener('click', () => {{
            locked = !locked;
            lockBtn.textContent = locked ? 'Lock Positions' : 'Unlock Dragging';
            lockBtn.classList.toggle('locked', locked);
            document.querySelectorAll('.ring-button').forEach(b => {{
                b.style.cursor = locked ? 'default' : 'move';
            }});
        }});

        document.querySelectorAll('.ring-button').forEach(btn => {{
            btn.addEventListener('mousedown', e => {{
                if (locked) return;
                dragging = btn;
                const rect = btn.getBoundingClientRect();
                offset.x = e.clientX - rect.left;
                offset.y = e.clientY - rect.top;
                e.preventDefault();
            }});

            btn.addEventListener('click', e => {{
                if (dragging) {{
                    e.preventDefault();
                    return;
                }}
                if (btn.id === 'owl-ring') alert('You chose the wise Owl companion âœ¨');
                if (btn.id === 'koi-ring') alert('You chose the graceful Koi companion ðŸª·');
                if (btn.id === 'fox-ring') alert('You chose the clever Fox companion ðŸ”¥');
            }});
        }});

        document.addEventListener('mousemove', e => {{
            if (!dragging || locked) return;
            const x = (e.clientX - offset.x) / window.innerWidth * 100;
            const y = (e.clientY - offset.y) / window.innerHeight * 100;
            dragging.style.left = `${{x}}vw`;
            dragging.style.top = `${{y}}vh`;
            positions[dragging.id] = {{x, y}};
        }});

        document.addEventListener('mouseup', () => {{
            if (dragging) {{
                localStorage.setItem(dragging.id, JSON.stringify(positions[dragging.id]));
                dragging = null;
            }}
        }});
    </script>
</body>
</html>
"""

# This is the key: use components.html with height equal to viewport
html(full_html, height=1000, width=2000, scrolling=False)
